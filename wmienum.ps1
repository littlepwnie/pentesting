# Powershell enumeration through Windows Management Instrumentator
# Comment and uncomment commands according to your needs
# Happy hunting :D


# General information

"System information ( + AV, Peripherals, Updates)..."
Get-WmiObject -Class Win32_ComputerSystem
wmic computersystem LIST full
wmic /namespace:\\root\securitycenter2 path antivirusproduct
# wmic path Win32_PnPdevice 
# wmic qfe list brief

# "Network adapters..."
# Get-WmiObject -Class Win32_NetworkAdapterConfiguration

"Collectin User account information..."
Get-WmiObject -Class Win32_UserAccount
# wmic USERACCOUNT Get Domain,Name,Sid

"Collectin Goup information..."
Get-WmiObject -Class Win32_Group

# "Looking for shadow copies..."
# Get-WmiObject -Class Win32_shadowcopy

# "Directory Listing and File Search..."
# wmic DATAFILE where "path='\\Users\\test\\Documents\\'" GET Name,readable,size
# wmic DATAFILE where "drive='C:' AND Name like '%password%'" GET Name,readable,size /VALUE


# Active directory enumeration

"Computer name..."
Get-WmiObject -Namespace root/directory/ldap -Class ds_domain | select PSComputerName

"Domain..."
(Get-WmiObject -Class win32_computersystem).Domain
# wmic NTDOMAIN GET DomainControllerAddress,DomainName,Roles /VALUE

"Password policy..."
Get-WmiObject -Namespace root/directory/ldap -Class ds_domain | select DS_lockoutDuration, DS_lockOutObservationWindow, DS_lockoutThreshold, DS_maxPwdAge, DS_minPwdAge, DS_minPwdLenght, DS_pwdHistoryLength, DS_pwdProperties

"List All Domain Users..."
wmic /NAMESPACE:\\root\directory\ldap PATH ds_user GET ds_samaccountname

"Collectin Group information..."
Get-WmiObject -Class Win32_GroupInDomain
# wmic /NAMESPACE:\\root\directory\ldap PATH ds_group GET ds_samaccountname

# --- Members of A Group ---
# wmic /NAMESPACE:\\root\directory\ldap PATH ds_group where "ds_samaccountname='Domain Admins'" Get ds_member /Value
# wmic path win32_groupuser where (groupcomponent="win32_group.name="domain admins",domain="YOURDOMAINHERE"")

# --- Domain User Info ---
# wmic /NAMESPACE:\\root\directory\ldap PATH ds_user where "ds_samaccountname='testAccount'" GET

# "Group membership of the domain admins group for current and all trusted domains..."
# Get-WmiObject -Class Win32_GroupUser | Where-Object {$_.GroupComponent -match ""Domain Admins} | Foreach-Object {[wmi]$.PartComponent}

"Getting all domain computers' names..."
Get-WmiObject -Namespace root/directory/ldap -Class ds_computer | select -ExpandProperty ds_cn
# wmic /NAMESPACE:\\root\directory\ldap PATH ds_computer GET ds_samaccountname
# wmic /NAMESPACE:\\root\directory\ldap PATH ds_computer GET ds_dnshostname

$rdpprompt = Read-Host "Would you like to try to enable Remote Desktop on host? (y/n): "
if ($rdpprompt -eq "y"){
  wmic rdtoggle where AllowTSConnections="0" call SetAllowTSConnections "1"
  # wmic /node:remotehost path Win32_TerminalServiceSetting where AllowTSConnections="0" call SetAllowTSConnections "1"
} else {}

$comprompt = Read-Host "Would you like to execute a command on host? (y/n): "
if ($comprompt -eq "y"){
  $wmicommand = Read-Host "Enter a command: "
  wmic process call create $wmicommand
} else {}

Read-Host -Prompt "Press Enter to exit..."
